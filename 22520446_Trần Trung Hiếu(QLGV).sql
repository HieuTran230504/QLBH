create database QuanLyGiaoVu
use QuanLyGiaoVu
SET DATEFORMAT DMY;

create table KHOA
(
	MAKHOA  varchar(4) primary key,
	TENKHOA varchar(40),
	NGTLAP smalldatetime,
	TRGKHOA char(4)
)

create table MONHOC
(
	MAMH varchar(10) primary key,
	TENMH varchar(40),
	TCLT tinyint,
	TCTH tinyint,
	MAKHOA varchar(4)
)

create table DIEUKIEN
(
	MAMH varchar(10),
	MAMH_TRUOC varchar(10),
	constraint PK_DIEUKIEN primary key (MAMH, MAMH_TRUOC)
)

create table GIAOVIEN
(
	MAGV char(4) primary key,
	HOTEN varchar(40),
	HOCVI varchar(10),
	HOCHAM varchar(10),
	GIOITINH varchar(3),
	NGSINH smalldatetime,
	NGVL smalldatetime,
	HESO numeric(4,2),
	MUCLUONG money,
	MAKHOA varchar(4)
)

create table LOP
(
	MALOP char(3) primary key,
	TENLOP varchar(40),
	TRGLOP char(5),
	SISO tinyint,
	MAGVCN char(4)
)

create table HOCVIEN
(
	MAHV char(5) primary key,
	HO varchar(40),
	TEN varchar(10),
	NGSINH smalldatetime,
	GIOITINH varchar(3),
	NOISINH varchar(40),
	MALOP char(3)
)

create table GIANGDAY
(
	MALOP char(3),
	MAMH varchar(10),
	MAGV char(4),
	HOCKY tinyint,
	NAM smallint,
	TUNGAY smalldatetime,
	DENNGAY smalldatetime,
	constraint GIANGDAY_PK primary key (MALOP, MAMH)
)

create table KETQUATHI
(
	MAHV char(5),
	MAMH varchar(10),
	LANTHI tinyint,
	NGTHI smalldatetime,
	DIEM numeric(4,2),
	KQUA varchar(10),
	constraint KETQUATHI_PK primary key (MAHV, MAMH, LANTHI)
)


--INSERT KHOA
INSERT INTO KHOA VALUES('KHMT', 'Khoa hoc may tinh', '7/6/2005', 'GV01')
INSERT INTO KHOA VALUES('HTTT', 'He thong thong tin', '7/6/2005', 'GV02')
INSERT INTO KHOA VALUES('CNPM', 'Cong nghe phan mem', '7/6/2005', 'GV04')
INSERT INTO KHOA VALUES('MTT', 'Mang va truyen thong', '20/10/2005', 'GV03')
INSERT INTO KHOA VALUES('KTMT', 'Ky thuat may tinh', '20/12/2005', Null)

--INSERT LOP
INSERT INTO LOP VALUES('K11', 'Lop 1 khoa 1', 'K1108', 11, 'GV07')
INSERT INTO LOP VALUES('K12', 'Lop 2 khoa 1', 'K1205', 12, 'GV09')
INSERT INTO LOP VALUES('K13', 'Lop 3 khoa 1', 'K1305', 12, 'GV14')

--INSERT MONHOC
INSERT INTO MONHOC VALUES('THDC', 'Tin hoc dai cuong', 4, 1, 'KHMT')
INSERT INTO MONHOC VALUES('CTRR', 'Cau truc roi rac', 5, 0, 'KHMT')
INSERT INTO MONHOC VALUES('CSDL', 'Co so du lieu', 3, 1, 'HTTT')
INSERT INTO MONHOC VALUES('CTDLGT', 'Cau truc du lieu va giai thuat', 3, 1, 'KHMT')
INSERT INTO MONHOC VALUES('PTTKTT', 'Phan tich thiet ke thuat toan', 3, 0, 'KHMT')
INSERT INTO MONHOC VALUES('DHMT', 'Do hoa may tinh', 3, 1, 'KHMT')
INSERT INTO MONHOC VALUES('KTMT', 'Kien truc may tinh', 3, 0, 'KTMT')
INSERT INTO MONHOC VALUES('TKCSDL', 'Thiet ke co so du lieu', 3, 1, 'HTTT')
INSERT INTO MONHOC VALUES('PTTKHTTT', 'Phan tich thiet ke he thong thong tin', 4, 1, 'HTTT')
INSERT INTO MONHOC VALUES('HDH', 'He dieu hanh', 4, 0, 'KTMT')
INSERT INTO MONHOC VALUES('NMCNPM', 'Nhap mon cong nghe phan mem', 3, 0, 'CNPM')
INSERT INTO MONHOC VALUES('LTCFW', 'Lap trinh C for win', 3, 1, 'CNPM')
INSERT INTO MONHOC VALUES('LTHDT', 'Lap trinh huong doi tuong', 3, 1, 'CNPM')

--INSERT GIANGDAY
INSERT INTO GIANGDAY VALUES('K11', 'THDC', 'GV07', 1, 2006, '2/1/2006', '12/5/2006')
INSERT INTO GIANGDAY VALUES('K12', 'THDC', 'GV06', 1, 2006, '2/1/2006', '12/5/2006')
INSERT INTO GIANGDAY VALUES('K13', 'THDC', 'GV15', 1, 2006, '2/1/2006', '12/5/2006')
INSERT INTO GIANGDAY VALUES('K11', 'CTRR', 'GV02', 1, 2006, '9/1/2006', '17/5/2006')
INSERT INTO GIANGDAY VALUES('K12', 'CTRR', 'GV02', 1, 2006, '9/1/2006', '17/5/2006')
INSERT INTO GIANGDAY VALUES('K13', 'CTRR', 'GV08', 1, 2006, '9/1/2006', '17/5/2006')
INSERT INTO GIANGDAY VALUES('K11', 'CSDL', 'GV05', 2, 2006, '1/6/2006', '15/7/2006')
INSERT INTO GIANGDAY VALUES('K12', 'CSDL', 'GV09', 2, 2006, '1/6/2006', '15/7/2006')
INSERT INTO GIANGDAY VALUES('K13', 'CTDLGT', 'GV15', 2, 2006, '1/6/2006', '15/7/2006')
INSERT INTO GIANGDAY VALUES('K13', 'CSDL', 'GV05', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY VALUES('K13', 'DHMT', 'GV07', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY VALUES('K11', 'CTDLGT', 'GV15', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY VALUES('K12', 'CTDLGT', 'GV15', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY VALUES('K11', 'HDH', 'GV04', 1, 2007, '2/1/2007', '18/2/2007')
INSERT INTO GIANGDAY VALUES('K12', 'HDH', 'GV04', 1, 2007, '2/1/2007', '20/3/2007')
INSERT INTO GIANGDAY VALUES('K11', 'DHMT', 'GV07', 1, 2007, '18/2/2007', '20/3/2007')

--INSERT GIAOVIEN
INSERT INTO GIAOVIEN VALUES('GV01', 'Ho Thanh Son', 'PTS', 'GS', 'Nam', '2/5/1950', '11/1/2004','5.00',2250000, 'KHMT')
INSERT INTO GIAOVIEN VALUES('GV02', 'Tran Tam Thanh', 'TS', 'PGS', 'Nam', '17/12/1965', '20/4/2004','4.50',2025000, 'HTTT')
INSERT INTO GIAOVIEN VALUES('GV03', 'Do Nghiem Phung', 'TS', 'GS', 'Nu', '1/8/1950', '23/9/2004','4.00',1800000, 'CNPM')
INSERT INTO GIAOVIEN VALUES('GV04', 'Tran Nam Son', 'TS', 'PGS', 'Nam', '22/2/1961', '12/1/2005','4.50',2025000, 'KTMT')
INSERT INTO GIAOVIEN VALUES('GV05', 'Mai Thanh Danh', 'ThS', 'GV', 'Nam', '12/3/1958', '12/1/2005','3.00',1350000, 'HTTT')
INSERT INTO GIAOVIEN VALUES('GV06', 'Tran Doan Hung', 'TS', 'GV', 'Nam', '11/3/1953', '12/1/2005','4.50',2025000, 'KHMT')
INSERT INTO GIAOVIEN VALUES('GV07', 'Nguyen Minh Tien', 'ThS', 'GV', 'Nam', '23/11/1971', '1/3/2005','4.00',1800000, 'KHMT')
INSERT INTO GIAOVIEN VALUES('GV08', 'Le Thi Tran', 'KS', 'Null', 'Nu', '26/3/1974', '1/3/2005','1.69',760500, 'KHMT')
INSERT INTO GIAOVIEN VALUES('GV09', 'Nguyen To Lan', 'ThS', 'GV', 'Nu', '31/12/1966', '1/3/2005','4.00',1800000, 'HTTT')
INSERT INTO GIAOVIEN VALUES('GV10', 'Le Tran Anh Loan', 'KS', 'Null', 'Nu', '17/7/1972', '1/3/2005','1.86',837000, 'CNPM')
INSERT INTO GIAOVIEN VALUES('GV11', 'Ho Thanh Tung', 'CN', 'GV', 'Nam', '12/1/1980', '15/5/2005','2.67',1201500, 'MTT')
INSERT INTO GIAOVIEN VALUES('GV12', 'Tran Van Anh', 'CN', 'Null', 'Nu', '29/3/1981', '15/5/2005','1.69',760500, 'CNPM')
INSERT INTO GIAOVIEN VALUES('GV13', 'Nguyen Linh Dan', 'CN', 'Null', 'Nu', '23/5/1980', '15/5/2005','1.69',760500, 'KTMT')
INSERT INTO GIAOVIEN VALUES('GV14', 'Truong Minh Chau', 'ThS', 'GV', 'Nu', '30/11/1976', '15/5/2005','3.00',1350000, 'MTT')
INSERT INTO GIAOVIEN VALUES('GV15', 'Le Ha Thanh', 'ThS', 'GV', 'Nam', '4/5/1978', '15/5/2005','3.00',1350000, 'KHMT')

--INSERT DIEUKIEN
INSERT INTO DIEUKIEN VALUES('CSDL', 'CTRR')
INSERT INTO DIEUKIEN VALUES('CSDL', 'CTDLGT')
INSERT INTO DIEUKIEN VALUES('CTDLGT', 'THDC')
INSERT INTO DIEUKIEN VALUES('PTTKTT', 'THDC')
INSERT INTO DIEUKIEN VALUES('PTTKTT', 'CTDLGT')
INSERT INTO DIEUKIEN VALUES('DHMT', 'THDC')
INSERT INTO DIEUKIEN VALUES('LTHDT', 'THDC')
INSERT INTO DIEUKIEN VALUES('PTTKHTTT', 'CSDL')

--INSERT KETQUATHI
INSERT INTO KETQUATHI VALUES('K1101', 'CSDL', 1, '20/7/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1101', 'CTDLGT', 1, '28/12/2006', 9.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1101', 'THDC', 1, '20/5/2006', 9.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1101', 'CTRR', 1, '13/5/2006', 9.50, 'Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'CSDL', 1, '20/7/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'CSDL', 2, '27/7/2006', 4.25, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'CSDL', 3, '10/8/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'CTDLGT', 1, '28/12/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'CTDLGT', 2, '5/1/2007', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'CTDLGT', 3, '15/1/2007', 6.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'THDC', 1, '20/5/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1102', 'CTRR', 1, '13/5/2006', 7.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1103', 'CSDL', 1, '20/7/2006', 3.50, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1103', 'CSDL', 2, '27/7/2006', 8.25, 'Dat')
INSERT INTO KETQUATHI VALUES('K1103', 'CTDLGT', 1, '28/12/2006', 7.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1103', 'THDC', 1, '20/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1103', 'CTRR', 1, '13/5/2006', 6.50, 'Dat')
INSERT INTO KETQUATHI VALUES('K1104', 'CSDL', 1, '20/7/2006', 3.75, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104', 'CTDLGT', 1, '28/12/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104', 'THDC', 1, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104', 'CTRR', 1, '13/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104', 'CTRR', 2, '20/5/2006', 3.50, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104', 'CTRR', 3, '30/6/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1201', 'CSDL', 1, '20/7/2006', 6.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1201', 'CTDLGT', 1, '28/12/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1201', 'THDC', 1, '20/5/2006', 8.50, 'Dat')
INSERT INTO KETQUATHI VALUES('K1201', 'CTRR', 1, '13/5/2006', 9.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'CSDL', 1, '20/7/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'CTDLGT', 1, '28/12/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'CTDLGT', 2, '5/1/2007', 5.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'THDC', 1, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'THDC', 2, '27/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'CTRR', 1, '13/5/2006', 3.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'CTRR', 2, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202', 'CTRR', 3, '30/6/2006', 6.25, 'Dat')
INSERT INTO KETQUATHI VALUES('K1203', 'CSDL', 1, '20/7/2006', 9.25, 'Dat')
INSERT INTO KETQUATHI VALUES('K1203', 'CTDLGT', 1, '28/12/2006', 9.50, 'Dat')
INSERT INTO KETQUATHI VALUES('K1203', 'THDC', 1, '20/5/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1203', 'CTRR', 1, '13/5/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1204', 'CSDL', 1, '20/7/2006', 8.50, 'Dat')
INSERT INTO KETQUATHI VALUES('K1204', 'CTDLGT', 1, '28/12/2006', 6.75, 'Dat')
INSERT INTO KETQUATHI VALUES('K1204', 'THDC', 1, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1204', 'CTRR', 1, '13/5/2006', 6.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1301', 'CSDL', 1, '20/12/2006', 4.25, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1301', 'CTDLGT', 1, '25/7/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1301', 'THDC', 1, '20/5/2006', 7.75, 'Dat')
INSERT INTO KETQUATHI VALUES('K1301', 'CTRR', 1, '13/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1302', 'CSDL', 1, '20/12/2006', 6.75, 'Dat')
INSERT INTO KETQUATHI VALUES('K1302', 'CTDLGT', 1, '25/7/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1302', 'THDC', 1, '20/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1302', 'CTRR', 1, '13/5/2006', 8.50, 'Dat')
INSERT INTO KETQUATHI VALUES('K1303', 'CSDL', 1, '20/12/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303', 'CTDLGT', 1, '25/7/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303', 'CTDLGT', 2, '7/8/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303', 'CTDLGT', 3, '15/8/2006', 4.25, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303', 'THDC', 1, '20/5/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303', 'CTRR', 1, '13/5/2006', 3.25, 'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303', 'CTRR', 2, '20/5/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1304', 'CSDL', 1, '20/12/2006', 7.75, 'Dat')
INSERT INTO KETQUATHI VALUES('K1304', 'CTDLGT', 1, '25/7/2006', 9.75, 'Dat')
INSERT INTO KETQUATHI VALUES('K1304', 'THDC', 1, '20/5/2006', 5.50, 'Dat')
INSERT INTO KETQUATHI VALUES('K1304', 'CTRR', 1, '13/5/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1305', 'CSDL', 1, '20/12/2006', 9.25, 'Dat')
INSERT INTO KETQUATHI VALUES('K1305', 'CTDLGT', 1, '25/7/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1305', 'THDC', 1, '20/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI VALUES('K1305', 'CTRR', 1, '13/5/2006', 10.00, 'Dat')


--INSERT HOCVIEN
INSERT INTO HOCVIEN VALUES('K1101', 'Nguyen Van','A','27/1/1986','Nam','TpHCM','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1102', 'Tran Ngoc','Han','14/3/1986','Nu','Kien Giang','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1103', 'Ha Duy','Lap','18/4/1986','Nam','Nghe An','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1104', 'Tran Ngoc','Linh','30/3/1986','Nu','Tay Ninh','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1105', 'Tran Minh','Long','27/2/1986','Nam','TpHCM','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1106', 'Le Nhat','Minh','24/1/1986','Nam','TpHCM','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1107', 'Nguyen Nhu','Nhut','27/1/1986','Nam','Ha Noi','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1108', 'Nguyen Manh','Tam','27/2/1986','Nam','Kien Giang','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1109', 'Phan Thi Thanh','Tam','27/1/1986','Nu','Vinh Long','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1110', 'Le Hoai','Thuong','5/2/1986','Nu','Can Tho','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1111', 'Le Ha','Vinh','25/12/1986','Nam','Vinh Long','K11', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1201', 'Nguyen Van','B','11/2/1986','Nam','TpHCM','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1202', 'Nguyen Thi Kim','Duyen','18/1/1986','Nu','TpHCM','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1203', 'Tran Thi Kim','Duyen','17/9/1986','Nu','TpHCM','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1204', 'Truong My','Hanh','19/5/1986','Nu','Dong Nai','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1205', 'Nguyen Thanh','Nam','17/4/1986','Nam','TpHCM','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1206', 'Nguyen Thi Truc','Thanh','4/3/1986','Nu','Kien Giang','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1207', 'Tran Thi Bich','Thuy','8/2/1986','Nu','Nghe An','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1208', 'Huynh Thi Kim','Trieu','8/4/1986','Nu','Tay Ninh','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1209', 'Pham Thanh','Trieu','23/2/1986','Nam','TpHCM','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1210', 'Ngo Thanh','Tuan','14/2/1986','Nam','TpHCM','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1211', 'Do Thi','Xuan','9/3/1986','Nu','Ha Noi','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1212', 'Le Thi Phi','Yen','12/3/1986','Nu','TpHCM','K12', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1301', 'Nguyen Thi Kim','Cuc','9/6/1986','Nu','Kien Giang','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1302', 'Truong Thi My','Hien','18/3/1986','Nu','Nghe An','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1303', 'Le Duc','Hien','21/3/1986','Nam','Tay Ninh','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1304', 'Le Quang','Hien','18/4/1986','Nam','TpHCM','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1305', 'Le Thi','Huong','27/3/1986','Nu','TpHCM','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1306', 'Nguyen Thai','Huu','30/3/1986','Nam','Ha Noi','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1307', 'Tran Minh','Man','28/5/1986','Nam','TpHCM','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1308', 'Nguyen Hieu','Nghia','8/4/1986','Nam','Kien Giang','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1309', 'Nguyen Trung','Nghia','18/1/1987','Nam','Nghe An','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1310', 'Tran Thi Hong','Tham','22/4/1986','Nu','Tay Ninh','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1311', 'Tran Minh','Thuc','4/4/1986','Nam','TpHCM','K13', NULL, NULL, NULL)
INSERT INTO HOCVIEN VALUES('K1312', 'Nguyen Thi Kim','Yen','7/9/1986','Nu','TpHCM','K13', NULL, NULL, NULL)

--Tao khoa ngoai:
ALTER TABLE LOP ADD CONSTRAINT FK_TRGLOP FOREIGN KEY (TRGLOP) REFERENCES HOCVIEN(MAHV)
ALTER TABLE LOP ADD CONSTRAINT FK_MAGVCN FOREIGN KEY (MAGVCN) REFERENCES GIAOVIEN(MAGV)
ALTER TABLE KHOA ADD CONSTRAINT FK_TRGKHOA FOREIGN KEY (TRGKHOA) REFERENCES GIAOVIEN(MAGV)
ALTER TABLE GIAOVIEN ADD CONSTRAINT FK_GIAOVIEN_KHOA FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)
ALTER TABLE HOCVIEN ADD CONSTRAINT FK_HOCVIEN_LOP FOREIGN KEY (MALOP) REFERENCES LOP(MALOP)
ALTER TABLE GIANGDAY ADD CONSTRAINT FK_GIANGDAY_GIAOVIEN FOREIGN KEY (MAGV) REFERENCES GIAOVIEN(MAGV)

--PHAN I
--Cau 1-I:
alter table HOCVIEN
add GHICHU varchar(50), DIEMTB numeric(4,2), XEPLOAI varchar(10);

--Cau 2-I:
alter table HOCVIEN
add constraint CHECK_MAHV check
(
	(substring (MAHV, 1, 3) = MALOP)
	and (cast(substring (MAHV, 4, 5) as tinyint) between 1 and 99)
);

--Cau 3-I:
alter table HOCVIEN
add constraint KT_GTHV check (GIOITINH in ('Nam', 'Nu'));
alter table GIAOVIEN
add constraint KT_GTGV check (GIOITINH in ('Nam', 'Nu'));

--Cau 4-I:
alter table KETQUATHI
add constraint CHECK_DIEM check
(
	DIEM between 0 and 10
	and right(cast(DIEM as varchar), 3) like '.__'
);

--Cau 5-I:
alter table KETQUATHI
add constraint PL_KQUA check
(
	(KQUA = 'Dat' and DIEM between 5 and 10)
	or (KQUA = 'Khong dat' and DIEM < 5)
);

--Cau 6-I:
alter table KETQUATHI
add constraint CHECK_LANTHI check(LANTHI <= 3);

--Cau 7-I:
alter table GIANGDAY
add constraint CHECK_HK check(HOCKY between 1 and 3);

--Cau 8-I:
alter table GIAOVIEN
add constraint CHECK_HV check(HOCVI in ('CN', 'KS', 'Ths', 'TS', 'PTS'));

--Cau 9-I:
--INSERT VA UPDATE LOP
CREATE TRIGGER IN_UDT_TRGLOP ON LOP
FOR INSERT,UPDATE
AS
BEGIN
	IF NOT EXISTS(
		SELECT * 
		FROM INSERTED I, HOCVIEN HV
		WHERE I.TRGLOP = HV.MAHV)
	BEGIN
		PRINT 'ERRO: LOP TRUONG CUA LOP PHAI LA HOC VIEN CUA LOP DO'
		ROLLBACK TRAN
	END
END 
--DELETE HOCVIEN
CREATE TRIGGER DEL_HV ON HOCVIEN
FOR DELETE
AS
BEGIN
	IF EXISTS(
	SELECT *
	FROM DELETED D, LOP L
	WHERE L.TRGLOP = D.MAHV AND D.MALOP = L.MALOP)
	BEGIN 
		PRINT 'ERRO: HOC VIEN HIEN TAI DANG LAM LOP TRUONG'
		ROLLBACK TRAN
	END
END
	
--Cau 10-I:

--Cau 11-I:
ALTER TABLE HOCVIEN ADD CONSTRAINT CHECK_TUOI CHECK(YEAR(GETDATE()) - YEAR(NGSINH) >= 18)

--Cau 12-I:
ALTER TABLE GIANGDAY ADD CONSTRAINT CHECK_GIANGDAY CHECK(TUNGAY < DENNGAY)

--Cau 13-I:
ALTER TABLE GIAOVIEN ADD CONSTRAINT CHECK_TUOIGV CHECK(YEAR(NGVL) - YEAR(NGSINH) >= 22)

--Cau 14-I:
ALTER TABLE MONHOC ADD CONSTRAINT CHECK_TINCHI CHECK (ABS(TCLT - TCTH) <= 3)

--Phan II:
--Cau 1-II:
UPDATE GIAOVIEN
SET HESO = HESO + 0.2
WHERE MAGV IN (SELECT TRGKHOA FROM KHOA)

--Cau 2-II:
UPDATE HOCVIEN
SET DIEMTB = (
	SELECT AVG(DIEM)
	FROM(
		SELECT MAHV, MAMH, LANTHI, DIEM
		FROM KETQUATHI KQ1
		WHERE LANTHI >= ALL(
			SELECT LANTHI
			FROM KETQUATHI KQ2
			WHERE KQ2.MAMH = KQ1.MAMH AND KQ2.MAHV = KQ1.MAHV
		)
	) KQ
	WHERE HOCVIEN.MAHV = KQ.MAHV
)

--Cau 3-II:
UPDATE HOCVIEN
SET GHICHU = 'Cam thi'
WHERE MAHV IN(
	SELECT MAHV
	FROM KETQUATHI
	WHERE LANTHI = 3 AND DIEM < 5
)

--Cau 4-II:
UPDATE HOCVIEN
SET XEPLOAI = (
	CASE
		WHEN DIEMTB >= 9 THEN 'XS'
		WHEN DIEMTB >= 8 AND DIEMTB < 9 THEN 'G'
		WHEN DIEMTB >= 6.5 AND DIEMTB < 8 THEN 'K'
		WHEN DIEMTB >= 5 AND DIEMTB < 6.5 THEN 'TB'
		WHEN DIEMTB < 5 THEN 'Y'
	END
)

--Phan III:
--Cau 1-III:
SELECT MAHV, HO, TEN, NGSINH, HOCVIEN.MALOP
FROM HOCVIEN INNER JOIN LOP ON HOCVIEN.MAHV = LOP.TRGLOP;

--Cau 2-III:
SELECT HOCVIEN.MAHV, HO, TEN, LANTHI, DIEM
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE MAMH = 'CTRR' AND MALOP = 'K12'
ORDER BY TEN, HO;

--Cau 3-III:
SELECT HOCVIEN.MAHV, HO, TEN, TENMH
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
INNER JOIN MONHOC ON KETQUATHI.MAMH = MONHOC.MAMH
WHERE LANTHI = 1 AND KQUA = 'Dat';

--Cau 4-III:
SELECT HOCVIEN.MAHV, HO, TEN
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE MALOP = 'K11' AND MAMH = 'CTRR' AND LANTHI = 1 AND KQUA = 'Khong Dat';

--Cau 5-III:
SELECT DISTINCT HOCVIEN.MAHV, HO, TEN
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE LEFT(MALOP, 1) = 'K' AND MAMH = 'CTRR' 
AND NOT EXISTS
	(SELECT * FROM KETQUATHI
	WHERE KQUA = 'Dat' 
	AND MAMH = 'CTRR'
	AND MAHV = HOCVIEN.MAHV)

--Cau 6-III:
SELECT DISTINCT TENMH 
FROM MONHOC INNER JOIN GIANGDAY ON MONHOC.MAMH = GIANGDAY.MAMH
INNER JOIN GIAOVIEN ON GIANGDAY.MAGV = GIAOVIEN.MAGV
WHERE HOTEN = 'Tran Tam Thanh' AND HOCKY = 1 AND NAM = 2006

--Cau 7-III:
SELECT DISTINCT MONHOC.MAMH, TENMH
FROM MONHOC INNER JOIN GIANGDAY ON MONHOC.MAMH = GIANGDAY.MAMH
INNER JOIN LOP ON GIANGDAY.MAGV = LOP.MAGVCN
WHERE LOP.MALOP = 'K11' AND HOCKY = 1 AND NAM = 2006

--Cau 8-III:
SELECT DISTINCT HO, TEN
FROM HOCVIEN INNER JOIN LOP ON HOCVIEN.MAHV = LOP.TRGLOP
INNER JOIN GIAOVIEN ON LOP.MAGVCN = GIAOVIEN.MAGV
INNER JOIN GIANGDAY ON GIAOVIEN.MAGV = GIANGDAY.MAGV
INNER JOIN MONHOC ON GIANGDAY.MAMH = MONHOC.MAMH
WHERE GIAOVIEN.HOTEN = 'Nguyen To Lan' AND MONHOC.TENMH = 'Co So Du Lieu'

--Cau 9-III:
SELECT MONHOCTRUOC.MAMH, MONHOCTRUOC.TENMH
FROM MONHOC, MONHOC AS MONHOCTRUOC, DIEUKIEN
WHERE
	MONHOC.MAMH = DIEUKIEN.MAMH
	AND MONHOCTRUOC.MAMH = DIEUKIEN.MAMH_TRUOC
	AND MONHOC.TENMH = 'Co So Du Lieu'

--Cau 10-III:
SELECT MONHOC.MAMH, MONHOC.TENMH
FROM MONHOC INNER JOIN DIEUKIEN ON MONHOC.MAMH = DIEUKIEN.MAMH
INNER JOIN MONHOC AS MONHOCTRUOC ON DIEUKIEN.MAMH_TRUOC = MONHOCTRUOC.MAMH 
WHERE MONHOCTRUOC.TENMH = 'Cau Truc Roi Rac' 

--Cau 11-III:
SELECT HOTEN
FROM GIAOVIEN INNER JOIN GIANGDAY ON GIAOVIEN.MAGV = GIANGDAY.MAGV
WHERE MALOP = 'K11' AND HOCKY = 1 AND NAM = 2006
INTERSECT
(
	SELECT HOTEN
	FROM GIAOVIEN INNER JOIN GIANGDAY ON GIAOVIEN.MAGV = GIANGDAY.MAGV
	WHERE MALOP = 'K12' AND HOCKY = 1 AND NAM = 2006
)

--Cau 12-III:
SELECT HOCVIEN.MAHV, (Ho+' '+Ten) HoTen
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE MAMH = 'CSDL' AND LANTHI = 1 AND KQUA = 'Khong Dat'
AND NOT EXISTS
(
	SELECT * FROM KETQUATHI
	WHERE LANTHI > 1 AND KETQUATHI.MAHV = HOCVIEN.MAHV
)

--Cau 13-III:
SELECT MAGV, HOTEN
FROM GIAOVIEN
WHERE MAGV NOT IN (SELECT MAGV FROM GIANGDAY)

--Cau 14-III:
SELECT MAGV, HOTEN
FROM GIAOVIEN
WHERE NOT EXISTS(
	SELECT *
	FROM MONHOC
	WHERE MONHOC.MAKHOA = GIAOVIEN.MAKHOA
	AND NOT EXISTS(
		SELECT *
		FROM GIANGDAY
		WHERE GIANGDAY.MAMH = MONHOC.MAMH
		AND GIANGDAY.MAGV = GIAOVIEN.MAGV
	)
)

--Cau 15-III:
SELECT DISTINCT HO, TEN
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE MALOP = 'K11' 
AND ((LANTHI = 2 AND MAMH = 'CTRR' AND DIEM = 5)
OR HOCVIEN.MAHV IN (
	SELECT DISTINCT MAHV
	FROM KETQUATHI
	WHERE KQUA = 'Khong dat'
	GROUP BY MAHV, MAMH
	HAVING COUNT(LANTHI) > 3
))

--Cau 16-III:
SELECT HOTEN
FROM GIAOVIEN INNER JOIN GIANGDAY ON GIAOVIEN.MAGV = GIANGDAY.MAGV
WHERE MAMH = 'CTRR' 
GROUP BY GIAOVIEN.MAGV, HOTEN, HOCKY
HAVING COUNT(*) >= 2

--Cau 17-III:
SELECT HOCVIEN.*, DIEM AS 'DIEM THI CSDL SAU CUNG'
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE MAMH = 'CSDL' AND LANTHI = (
	SELECT MAX(LANTHI)
	FROM KETQUATHI
	WHERE MAMH = 'CSDL' AND KETQUATHI.MAHV = HOCVIEN.MAHV
	GROUP BY MAHV
)

--Cau 18-III:
SELECT HOCVIEN.*, DIEM AS 'DIEM THI CSDL CAO NHAT'
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
INNER JOIN MONHOC ON KETQUATHI.MAMH = MONHOC.MAMH
WHERE TENMH = 'Co So Du Lieu'
AND DIEM = (
	SELECT MAX(DIEM)
	FROM KETQUATHI INNER JOIN MONHOC ON KETQUATHI.MAMH = MONHOC.MAMH
	WHERE KETQUATHI.MAHV = HOCVIEN.MAHV
	AND TENMH = 'Co So Du Lieu'
	GROUP BY MAHV
)

--Cau 19-III:
SELECT MAKHOA, TENKHOA
FROM KHOA
WHERE NGTLAP = (
	SELECT MIN(NGTLAP)
	FROM KHOA
)

--Cau 20-III:
SELECT COUNT(*) SOGV
FROM GIAOVIEN
WHERE HOCHAM IN ('GS', 'PGS')

--Cau 21-III:
SELECT KHOA.MAKHOA, TENKHOA, HOCVI, COUNT(*) SOGV
FROM KHOA INNER JOIN GIAOVIEN ON KHOA.MAKHOA = GIAOVIEN.MAKHOA
WHERE HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS')
GROUP BY KHOA.MAKHOA, TENKHOA, HOCVI
ORDER BY KHOA.MAKHOA

--Cau 22-III:
SELECT MONHOC.MAMH, TENMH, KQUA, COUNT(*) SOHV
FROM MONHOC INNER JOIN KETQUATHI ON MONHOC.MAMH = KETQUATHI.MAMH
GROUP BY MONHOC.MAMH, KQUA, TENMH
ORDER BY MONHOC.MAMH

--Cau 23-III:
SELECT DISTINCT GIAOVIEN.MAGV, HOTEN
FROM GIAOVIEN INNER JOIN GIANGDAY ON GIAOVIEN.MAGV = GIANGDAY.MAGV
INNER JOIN LOP ON GIAOVIEN.MAGV = LOP.MAGVCN

--Cau 24-III:
SELECT HO, TEN
FROM HOCVIEN INNER JOIN LOP ON HOCVIEN.MAHV = LOP.TRGLOP
WHERE SISO >= ALL(SELECT SISO FROM LOP)

--Cau 25-III:
SELECT HO, TEN
FROM HOCVIEN INNER JOIN LOP ON HOCVIEN.MAHV = LOP.TRGLOP
INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE KQUA = 'Khong dat'
GROUP BY TRGLOP, HO, TEN
HAVING COUNT(*) > 3

--Cau 26-III:
SELECT HOCVIEN.MAHV, HO, TEN
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE DIEM >= 9
GROUP BY HOCVIEN.MAHV, HO, TEN
HAVING COUNT(*) >= ALL(
	SELECT COUNT(*)
	FROM KETQUATHI
	WHERE DIEM >= 9
	GROUP BY MAHV
)

--Cau 27-III:
SELECT MALOP, MAHV, HO, TEN
FROM (
	SELECT MALOP, HOCVIEN.MAHV, HO, TEN, COUNT(*) SLDIEM, RANK() OVER(PARTITION BY MALOP ORDER BY COUNT(*) DESC) AS XEPHANG
	FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
	WHERE DIEM >= 9
	GROUP BY MALOP, HOCVIEN.MAHV, HO, TEN
) AS A
WHERE A.XEPHANG = 1

--Cau 28-III:
SELECT NAM, HOCKY, MAGV, COUNT(DISTINCT MAMH) SOMONGD, COUNT(DISTINCT MALOP) SOLOPGD
FROM GIANGDAY 
GROUP BY NAM, HOCKY, MAGV

--Cau 29-III:
SELECT NAM, HOCKY, MAGV, HOTEN
FROM (
	SELECT NAM, HOCKY, GIANGDAY.MAGV, HOTEN, RANK() OVER (PARTITION BY HOCKY, NAM ORDER BY COUNT(*) DESC) AS XEPHANG
	FROM GIANGDAY INNER JOIN GIAOVIEN ON GIANGDAY.MAGV = GIAOVIEN.MAGV
	GROUP BY NAM, HOCKY, GIANGDAY.MAGV, HOTEN
) AS A
WHERE A.XEPHANG = 1
ORDER BY NAM, HOCKY

--Cau 30-III:
SELECT MONHOC.MAMH, TENMH
FROM MONHOC INNER JOIN KETQUATHI ON MONHOC.MAMH = KETQUATHI.MAMH
WHERE LANTHI = 1 AND KQUA = 'Khong Dat'
GROUP BY MONHOC.MAMH, TENMH
HAVING COUNT(*) >= ALL (
	SELECT COUNT(*) 
	FROM KETQUATHI
	WHERE LANTHI = 1 AND KQUA = 'Khong Dat'
	GROUP BY MAMH
)

--Cau 31-III:
SELECT DISTINCT HOCVIEN.MAHV, HO, TEN
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE LANTHI = 1 AND NOT EXISTS(
	SELECT *
	FROM KETQUATHI
	WHERE LANTHI = 1 AND KQUA = 'Khong Dat'
	AND MAHV = HOCVIEN.MAHV
)

--Cau 32-III:
SELECT DISTINCT HOCVIEN.MAHV, HO, TEN
FROM HOCVIEN INNER JOIN KETQUATHI ON HOCVIEN.MAHV = KETQUATHI.MAHV
WHERE NOT EXISTS(
	SELECT *
	FROM KETQUATHI
	WHERE KQUA = 'Khong Dat' AND LANTHI = (
		SELECT MAX(LANTHI)
		FROM KETQUATHI
		WHERE MAHV = HOCVIEN.MAHV
		GROUP BY MAHV)
	AND MAHV = HOCVIEN.MAHV
)

--Cau 33-III:
SELECT MAHV, HO, TEN
FROM HOCVIEN
WHERE NOT EXISTS(
	SELECT *
	FROM MONHOC
	WHERE NOT EXISTS(
		SELECT *
		FROM KETQUATHI
		WHERE KETQUATHI.MAMH = MONHOC.MAMH AND KETQUATHI.MAHV = HOCVIEN.MAHV
		AND LANTHI = 1 AND KQua = 'Dat'
	)
)

--Cau 34-III:
SELECT MAHV, HO, TEN
FROM HOCVIEN
WHERE NOT EXISTS(
	SELECT *
	FROM MONHOC
	WHERE NOT EXISTS(
		SELECT *
		FROM KETQUATHI
		WHERE KETQUATHI.MAMH = MONHOC.MAMH AND KETQUATHI.MAHV = HOCVIEN.MAHV
		AND KQua = 'Dat' AND LANTHI = (
			SELECT MAX(LANTHI)
			FROM KETQUATHI
			WHERE MAHV = HOCVIEN.MAHV
			GROUP BY MAHV)
		)
)

--Cau 35-III:
SELECT MAMH, KQSC.MAHV, HO, TEN, DIEM
FROM (
	SELECT MAHV, MAMH, LANTHI, DIEM
	FROM KETQUATHI KQ1
	WHERE LANTHI >= ALL(
		SELECT LANTHI
		FROM KETQUATHI KQ2
		WHERE KQ2.MAHV = KQ1.MAHV AND KQ2.MAMH = KQ1.MAMH)
) AS KQSC
INNER JOIN HOCVIEN ON KQSC.MAHV = HOCVIEN.MAHV
GROUP BY MAMH, KQSC.MAHV, HO, TEN, DIEM
HAVING KQSC.DIEM >= ALL(
	SELECT DIEM
	FROM KETQUATHI KQ1
	WHERE LANTHI >= ALL(
		SELECT LANTHI
		FROM KETQUATHI KQ2
		WHERE KQ2.MAHV = KQ1.MAHV AND KQ2.MAMH = KQ1.MAMH)
)


